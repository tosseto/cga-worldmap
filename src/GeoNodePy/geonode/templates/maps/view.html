{% extends "fullscreen.html" %}
{% load i18n %}

{% block title %} {{maptitle}}{% endblock %}

{% block head %}
{% include "geonode/ext_header.html" %}
{% include "geonode/app_header.html" %}
{% include "geonode/geo_header.html" %}

<script src="http://www.google.com/jsapi?key={{GOOGLE_API_KEY}}"></script>
<script type="text/javascript">
    google.load("earth", "1");
    google.load("maps", "3.2", {other_params: "sensor=false"});
</script>


<link rel="stylesheet" type="text/css" href="{{ GEONODE_CLIENT_LOCATION }}theme/ux/colorpicker/color-picker.ux.css" />
<style type="text/css">
    #templates { display: none; }
</style>

<script src="{{ GEONODE_CLIENT_LOCATION }}script/PrintPreview.js"></script>
<link rel="stylesheet" type="text/css" href="{{ GEONODE_CLIENT_LOCATION }}externals/PrintPreview/resources/css/printpreview.css" />
<script src="{{GEOSERVER_BASE_URL}}pdf/info.json?var=printCapabilities" type="text/javascript"></script>
{{ block.super }}

<script type="text/javascript">
var app;
Ext.onReady(function() {
{% autoescape off %}
    var config = Ext.apply({
        tools:  [{
                    ptype: "gxp_geonodequerytool",
                    actionTarget:  {target: "paneltbar", index: 4},
                    toolText: '<span class="x-btn-text">Identify</span>',
                    iconCls: null,
                    outputConfig: {width: 400, height: 200, panIn: false},
                    featurePanel: 'queryPanel',
                    attributePanel: 'gridWinPanel'
                }],
        proxy: "/proxy/?url=",

        /* The URL to a REST map configuration service.  This service
         * provides listing and, with an authenticated user, saving of
         * maps on the server for sharing and editing.
         */
        rest: "/maps/",
        homeUrl: "{% url geonode.views.index %}",
        siteUrl: "{{ SITE_URL }}",
        localGeoServerBaseUrl: "{{ GEOSERVER_BASE_URL }}",
        csrfToken: "{{ csrf_token }}",
        authorizedRoles: "{{ user.is_authenticated|yesno:"ROLE_ADMINISTRATOR,ROLE_ANONYMOUS" }}"
    }, {{ config }});



    app = new GeoExplorer(config, true);

    var permalinkTemplate = new Ext.Template("{protocol}//{host}/maps/{id}/edit");
    var permalink = function(id) {
            return permalinkTemplate.apply({
                protocol: window.location.protocol,
                host: window.location.host,
                id: id
            })
        };


    var titleTemplate = new Ext.Template("<span>{title}</span>");
    Ext.DomHelper.overwrite(Ext.get("page-breadcrumb"), titleTemplate.apply({title: (config.about.officialurl ? '' : 'Current Map: ') + (config.about.title ? config.about.title : 'New Map')}));

    app.on("saved", function(id) {
        //reset title header
        Ext.DomHelper.overwrite(Ext.get("page-breadcrumb"), titleTemplate.apply({title: (config.about.officialurl ? '' : 'Current Map: ') + (config.about.title ? config.about.title : 'New Map')}));




    }, this);
{% endautoescape %}
});
</script>

{% endblock %}

{% block body %}
<div id="header-wrapper">
  {{ block.super }}

    <div id="dataTabs" class="x-hidden">

<div id="searchDiv" style="background-color:#fff;width:800px;">
<div style="float:left;position:relative;margin:10px;width:580px;">
  <div class="block">
    <h2>{% trans "Search" %} <span class="subtitle">{% trans "for geospatial data" %}</span></h2>

    <div id="search_results"></div>

  </div>

  <div class="block wrap selfclear">
  <h3>Selected Data</h3>
  <div id="selection">
    <div id="data_cart"></div>
    </div>
    <div id="data_ops">
    </div>
  </div>


</div>



<div style="position:relative;float:right;width:200px">
  <div id="refine" class="block">
    <h3>{% trans "Refine Search" %}</h3>
    <div class="bbox-controls">
      <div class="bbox-enabled"><input type="checkbox" /> {% trans "By area" %}</div>
      <p><span class="explain">{% blocktrans %}Limit the search to data that includes features in the displayed area.{% endblocktrans %}</span></p>
      <div class="bbox-expand">
      </div>
    </div>
    <div class="search-button">Refine</div>
  </div>

</div>
</div>
        <div id="externalDiv"></div>
        <div id="uploadDiv"></div>
    </div>

</div>
{% endblock %}

